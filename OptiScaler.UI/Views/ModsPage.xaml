<Page
    x:Class="OptiScaler.UI.Views.ModsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Background="Transparent">

    <ScrollViewer>
        <StackPanel Spacing="24" Padding="32">
            
            <!-- Hero Header -->
            <Grid 
                Height="120" 
                CornerRadius="12"
                Background="{StaticResource HeroGradient}">
                <StackPanel 
                    VerticalAlignment="Center" 
                    Padding="32,0"
                    Spacing="8">
                    <TextBlock 
                        Text="Mod Manager"
                        FontSize="32"
                        FontWeight="Bold"
                        Foreground="White"/>
                    <TextBlock 
                        Text="Download and manage OptiScaler versions from GitHub"
                        FontSize="16"
                        Foreground="#CCFFFFFF"/>
                </StackPanel>
                
                <!-- Action Buttons in Header -->
                <StackPanel 
                    Orientation="Horizontal" 
                    Spacing="12"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,20,20,0">
                    
                    <!-- Open Downloads Folder Button -->
                    <Button 
                        Style="{StaticResource XboxButtonStyle}"
                        Click="OpenDownloadsFolder_Click"
                        Height="36"
                        MinWidth="110">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon Glyph="&#xE8B7;" FontSize="14"/>
                            <TextBlock Text="Open Folder"/>
                        </StackPanel>
                    </Button>

                    <!-- Check Updates Button -->
                    <Button 
                        Style="{StaticResource XboxGreenButtonStyle}"
                        Click="CheckForUpdates_Click"
                        Height="36"
                        MinWidth="140">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon Glyph="&#xE72C;" FontSize="14"/>
                            <TextBlock Text="Check Updates"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Status Progress Bar -->
            <StackPanel 
                VerticalAlignment="Center" 
                Spacing="8"
                Visibility="{x:Bind ViewModel.IsDownloading, Mode=OneWay}">
                <TextBlock 
                    Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                    FontSize="14"
                    Foreground="White"
                    TextWrapping="Wrap"/>
                <ProgressBar 
                    Value="{x:Bind ViewModel.DownloadProgress, Mode=OneWay}"
                    Maximum="100"
                    Height="4"/>
            </StackPanel>

            <!-- OptiScaler Releases -->
            <Expander 
                IsExpanded="{x:Bind ViewModel.IsOptiScalerExpanded, Mode=TwoWay}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Visibility="{x:Bind ViewModel.HasOptiScalerReleases, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                <Expander.Header>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock 
                            Grid.Column="0"
                            Text="OptiScaler Releases"
                            FontSize="20"
                            FontWeight="SemiBold"
                            Foreground="White"/>
                        
                        <TextBlock 
                            Grid.Column="1"
                            Text="{x:Bind ViewModel.OptiScalerDownloadedInfo, Mode=OneWay}"
                            FontSize="14"
                            FontStyle="Italic"
                            Foreground="{x:Bind ViewModel.IsOptiScalerUpdateAvailable, Mode=OneWay, Converter={StaticResource UpdateAvailableToBrushConverter}}"
                            Margin="16,0,0,0"
                            VerticalAlignment="Center"
                            Visibility="{x:Bind ViewModel.HasOptiScalerDownloaded, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    </Grid>
                </Expander.Header>
                <Border 
                    Background="{StaticResource CardDarkBrush}"
                    CornerRadius="12"
                    Padding="24"
                    BorderBrush="#33FFFFFF"
                    BorderThickness="1"
                    Margin="0,8,0,0">
                    <StackPanel Spacing="16">
                        <ListView
                            ItemsSource="{x:Bind ViewModel.DisplayedOptiScalerReleases, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedOptiScalerRelease, Mode=TwoWay}"
                            SelectionMode="Single"
                            Background="Transparent"
                            MaxHeight="400">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="12" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock 
                                                Text="{Binding Release.TagName}"
                                                FontSize="16"
                                                FontWeight="SemiBold"
                                                Foreground="White"/>
                                            <TextBlock 
                                                Text="{Binding Release.Name}"
                                                FontSize="14"
                                                Foreground="#CCCCCC"/>
                                            <TextBlock 
                                                FontSize="12"
                                                Foreground="#999999">
                                                <Run Text="Published:"/>
                                                <Run Text="{Binding Release.PublishedAt}"/>
                                            </TextBlock>
                                            <TextBlock FontSize="12" Foreground="#AAAAAA" Text="{Binding LocalPath, Converter={StaticResource NullToTextConverter}, ConverterParameter='Not downloaded'}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                            <!-- Download button visible only if not downloaded -->
                                            <Button Style="{StaticResource XboxGreenButtonStyle}" Click="DownloadOptiScaler_Click" Tag="{Binding}" VerticalAlignment="Center" Visibility="{Binding IsDownloaded, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=invert}">
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <FontIcon Glyph="&#xE896;" FontSize="14"/>
                                                    <TextBlock Text="Download"/>
                                                </StackPanel>
                                            </Button>

                                            <!-- Delete button visible only if downloaded -->
                                            <Button Style="{StaticResource XboxButtonStyle}" Click="DeleteDownloaded_Click" Tag="{Binding}" VerticalAlignment="Center" Visibility="{Binding IsDownloaded, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                                    <TextBlock Text="Delete"/>
                                                </StackPanel>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <Button 
                            Style="{StaticResource XboxButtonStyle}" 
                            Click="ToggleShowMore_Click" 
                            HorizontalAlignment="Center"
                            MinWidth="120"
                            Visibility="{x:Bind ViewModel.OptiScalerReleases.Count, Mode=OneWay, Converter={StaticResource CountToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE70D;" FontSize="14"/>
                                <TextBlock>
                                    <Run Text="{x:Bind ViewModel.ShowAllOptiScaler, Mode=OneWay, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Show Less|Show More'}"/>
                                </TextBlock>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Expander>

            <!-- OptiPatcher Releases -->
            <Expander 
                IsExpanded="{x:Bind ViewModel.IsOptiPatcherExpanded, Mode=TwoWay}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Visibility="{x:Bind ViewModel.HasOptiPatcherReleases, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                <Expander.Header>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock 
                            Grid.Column="0"
                            Text="OptiPatcher Releases"
                            FontSize="20"
                            FontWeight="SemiBold"
                            Foreground="White"/>
                        
                        <TextBlock 
                            Grid.Column="1"
                            Text="{x:Bind ViewModel.OptiPatcherDownloadedInfo, Mode=OneWay}"
                            FontSize="14"
                            FontStyle="Italic"
                            Foreground="{x:Bind ViewModel.IsOptiPatcherUpdateAvailable, Mode=OneWay, Converter={StaticResource UpdateAvailableToBrushConverter}}"
                            Margin="16,0,0,0"
                            VerticalAlignment="Center"
                            Visibility="{x:Bind ViewModel.HasOptiPatcherDownloaded, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    </Grid>
                </Expander.Header>
                <Border 
                    Background="{StaticResource CardDarkBrush}"
                    CornerRadius="12"
                    Padding="24"
                    BorderBrush="#33FFFFFF"
                    BorderThickness="1"
                    Margin="0,8,0,0">
                    <StackPanel Spacing="16">
                        <ListView
                            ItemsSource="{x:Bind ViewModel.DisplayedOptiPatcherReleases, Mode=OneWay}"
                            SelectedItem="{x:Bind ViewModel.SelectedOptiPatcherRelease, Mode=TwoWay}"
                            SelectionMode="Single"
                            Background="Transparent"
                            MaxHeight="400">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="12" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock 
                                                Text="{Binding Release.TagName}"
                                                FontSize="16"
                                                FontWeight="SemiBold"
                                                Foreground="White"/>
                                            <TextBlock 
                                                Text="{Binding Release.Name}"
                                                FontSize="14"
                                                Foreground="#CCCCCC"/>
                                            <TextBlock 
                                                FontSize="12"
                                                Foreground="#999999">
                                                <Run Text="Published:"/>
                                                <Run Text="{Binding Release.PublishedAt}"/>
                                            </TextBlock>
                                            <TextBlock FontSize="12" Foreground="#AAAAAA" Text="{Binding LocalPath, Converter={StaticResource NullToTextConverter}, ConverterParameter='Not downloaded'}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                            <Button 
                                                Style="{StaticResource XboxGreenButtonStyle}"
                                                Click="DownloadOptiPatcher_Click"
                                                Tag="{Binding}"
                                                VerticalAlignment="Center"
                                                Visibility="{Binding IsDownloaded, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=invert}">
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <FontIcon Glyph="&#xE896;" FontSize="14"/>
                                                    <TextBlock Text="Download"/>
                                                </StackPanel>
                                            </Button>

                                            <Button 
                                                Style="{StaticResource XboxButtonStyle}"
                                                Click="DeleteDownloaded_Click"
                                                Tag="{Binding}"
                                                VerticalAlignment="Center"
                                                Visibility="{Binding IsDownloaded, Converter={StaticResource BoolToVisibilityConverter}}">
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                                    <TextBlock Text="Delete"/>
                                                </StackPanel>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <Button 
                            Style="{StaticResource XboxButtonStyle}" 
                            Click="ToggleShowMoreOptiPatcher_Click" 
                            HorizontalAlignment="Center"
                            MinWidth="120"
                            Visibility="{x:Bind ViewModel.OptiPatcherReleases.Count, Mode=OneWay, Converter={StaticResource CountToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE70D;" FontSize="14"/>
                                <TextBlock>
                                    <Run Text="{x:Bind ViewModel.ShowAllOptiPatcher, Mode=OneWay, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Show Less|Show More'}"/>
                                </TextBlock>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Expander>

        </StackPanel>
    </ScrollViewer>
</Page>
